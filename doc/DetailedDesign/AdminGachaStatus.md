---

# マイガチャ状況確認画面 詳細設計

## **1. 概要**
マイガチャ状況確認画面では、ユーザーが作成したガチャの詳細な状況を確認できます。この画面では、以下の情報を提供します。
- **アイテムごとの在庫状況**: 初期在庫数と現在の残り数を表示。
- **アイテムの当選者情報**: ガチャ排出日時、当選者のユーザー名、メールアドレスを一覧表示。

---

## **2. URL構造**
- **マイガチャ状況確認画面**: `/my-gacha/:id/status`
  - `:id` はガチャIDを表します。

---

## **3. 画面仕様**

### **3.1 レイアウト**
- **ヘッダー**:
  - ガチャ名、ガチャの説明を表示。
- **アイテム在庫状況セクション**:
  - アイテム名、残り数、初期在庫数を表示。
  - 残り数が0の場合は「SOLD OUT」を赤字で表示。
- **当選者情報セクション**:
  - 当選者のユーザー名、メールアドレス、当選アイテム名、ガチャ排出日時を表示。
  - ページネーション対応（20件/ページ）。
- **フッター**:
  - 「マイガチャ画面へ戻る」ボタン。

---

## **4. API設計**

### **4.1 ガチャ状況取得 API**
- **エンドポイント**: `GET /api/my/:id/status`
- **リクエストパラメータ**:
  - `id` (必須): ガチャID。
  - `page` (任意): ページ番号（デフォルト: 1）。
- **レスポンス例**:
```json
{
  "gacha": {
    "id": 1,
    "name": "サンプルガチャ",
    "description": "サンプルガチャの説明",
    "items": [
      {
        "id": 101,
        "name": "アイテムA",
        "initial_stock": 100,
        "remaining_stock": 20
      },
      {
        "id": 102,
        "name": "アイテムB",
        "initial_stock": 50,
        "remaining_stock": 0
      }
    ]
  },
  "winners": [
    {
      "item_id": 101,
      "user": {
        "name": "山田太郎",
        "email": "taro@example.com"
      },
      "drawn_at": "2025-08-28T12:34:56Z"
    },
    {
      "item_id": 102,
      "user": {
        "name": "鈴木花子",
        "email": "hanako@example.com"
      },
      "drawn_at": "2025-08-27T15:20:30Z"
    }
  ],
  "pagination": {
    "current_page": 1,
    "total_pages": 3
  }
}
```

---

## **5. フロントエンド設計**

### **5.1 コンポーネント構成**
- **`MyGachaStatus.js`**:
  - ガチャ状況画面のメインコンポーネント。
  - APIからデータを取得し、子コンポーネントに渡す。
- **`ItemStockList.js`**:
  - アイテムごとの在庫状況を表示するコンポーネント。
- **`WinnerList.js`**:
  - 当選者情報を表示するコンポーネント。
  - ページネーション機能を含む。

---

## **6. UI/UX**

### **6.1 アイテム在庫状況セクション**
- **表示項目**:
  - アイテム名。
  - 残り数 / 初期在庫数。
  - 残り数が0の場合に「SOLD OUT」が表示される。
- **デザイン**:
  - テーブル形式で表示。
  - Material-UI の `Table` コンポーネントを使用。

### **6.2 当選者情報セクション**
- **表示項目**:
  - 当選者の名前、メールアドレス、排出日時。
- **デザイン**:
  - テーブル形式で表示。
  - ページネーション対応（Material-UI の `Pagination` コンポーネントを使用）。

---

## **7. バックエンド設計**

### **7.1 データベース**
- **`gacha_items` テーブル**:
  - `initial_stock` カラム: 初期在庫数を保持。
  - `remaining_stock` カラム: 現在の残り在庫数を保持。
- **`gacha_results` テーブル**:
  - `user_id` カラム: 当選者のユーザーID。
  - `item_id` カラム: 当選アイテムのID。
  - `created_at` カラム: ガチャ排出日時。

### **7.2 ロジック**
- **在庫数の計算**:
  - `remaining_stock` はガチャ実行時にデクリメント。
- **当選者情報の取得**:
  - `gacha_results` テーブルを `users`、`gacha_items` テーブルと JOIN して取得。

---

## **8. テストケース**

### **8.1 フロントエンド**
1. **在庫状況の表示**:
   - 残り数が正しく表示されること。
   - 残り数が0の場合に「SOLD OUT」が表示されること。
2. **当選者情報の表示**:
   - 当選者の名前、メールアドレス、排出日時が正しく表示されること。
3. **ページネーション**:
   - ページ切り替えが正しく動作すること。

### **8.2 バックエンド**
1. **APIレスポンス**:
   - 正しいガチャ状況データが返却されること。
2. **在庫数の更新**:
   - ガチャ実行時に `remaining_stock` が正しくデクリメントされること。
3. **当選者情報の取得**:
   - `gacha_results` テーブルから正しいデータが取得されること。

---