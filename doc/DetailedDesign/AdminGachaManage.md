# ã‚¬ãƒãƒ£ç®¡ç†ç”»é¢ è©³ç´°è¨­è¨ˆ âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†ãƒ»URLåˆ†é›¢å®Œäº†

## 1. ç”»é¢æ¦‚è¦
- ã‚¬ãƒãƒ£ã®æ–°è¦ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†ã‚’è¡Œã†ãŸã‚ã®ç®¡ç†ç”»é¢
- ã‚¬ãƒãƒ£ã”ã¨ã«ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚„åœ¨åº«æ•°ãªã©ã‚’ç®¡ç†
- ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ã‚¬ãƒãƒ£ã‚’ç®¡ç†å¯èƒ½
- **å®Ÿè£…çŠ¶æ³**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Œå…¨å®Ÿè£…æ¸ˆã¿ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…å¾…ã¡
- **URLæ§‹é€ **: 
  - ãƒã‚¤ã‚¬ãƒãƒ£ç®¡ç†: `/my-gacha`
  - ã‚¬ãƒãƒ£æ–°è¦ä½œæˆ: `/my-gacha/new`
  - ã‚¬ãƒãƒ£ç·¨é›†: `/my-gacha/edit/:id`

## 2. ç”»é¢æ§‹æˆ

### 2.1 ã‚¬ãƒãƒ£ä¸€è¦§ç”»é¢ï¼ˆAdminGachaManageï¼‰âœ… URLåˆ†é›¢å®Œäº†
- **URL**: `/my-gacha`
- ã‚¬ãƒãƒ£ä¸€è¦§è¡¨ç¤ºï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
  - ã‚¬ãƒãƒ£åã€èª¬æ˜ã€ä¾¡æ ¼ã€å…¬é–‹çŠ¶æ…‹ã€ä½œæˆæ—¥æ™‚
  - å…¬é–‹/éå…¬é–‹ã®åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ
- æ–°è¦ã‚¬ãƒãƒ£ä½œæˆãƒœã‚¿ãƒ³ï¼ˆé·ç§»å…ˆ: `/my-gacha/new`ï¼‰
- å„ã‚¬ãƒãƒ£ã®ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆç·¨é›†é·ç§»å…ˆ: `/my-gacha/edit/:id`ï¼‰
- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½ï¼ˆå°†æ¥å¯¾å¿œï¼‰

### 2.2 ã‚¬ãƒãƒ£ç·¨é›†/æ–°è¦ä½œæˆç”»é¢ï¼ˆAdminGachaEditï¼‰âœ… URLåˆ†é›¢å®Œäº†
- **æ–°è¦ä½œæˆURL**: `/my-gacha/new`
- **ç·¨é›†URL**: `/my-gacha/edit/:id`
- URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚¬ãƒãƒ£IDã‚’è‡ªå‹•å–å¾—
- åŸºæœ¬æƒ…å ±å…¥åŠ›
  - ã‚¬ãƒãƒ£åï¼ˆå¿…é ˆã€æœ€å¤§128æ–‡å­—ï¼‰
  - èª¬æ˜æ–‡ï¼ˆæœ€å¤§1000æ–‡å­—ï¼‰
  - ä¾¡æ ¼ï¼ˆå¿…é ˆã€1ä»¥ä¸Šã®æ•´æ•°ï¼‰
  - å…¬é–‹/éå…¬é–‹åˆ‡æ›¿
  - è¡¨ç¤ºæœŸé–“ï¼ˆé–‹å§‹æ—¥ãƒ»çµ‚äº†æ—¥ã€ä»»æ„ï¼‰
- **ã‚¬ãƒãƒ£ç”»åƒç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰**
  - ã‚¬ãƒãƒ£ç”»åƒä¸€è¦§è¡¨ç¤ºï¼ˆè¤‡æ•°ç”»åƒå¯¾å¿œï¼‰
  - ãƒ¡ã‚¤ãƒ³ç”»åƒã®è¨­å®šï¼ˆæœ€åˆã®ç”»åƒã‚’è‡ªå‹•ã§ãƒ¡ã‚¤ãƒ³ç”»åƒã«è¨­å®šï¼‰
  - ç”»åƒã®ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰
  - ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«åŒæ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œï¼‰
  - Sharp.jsè‡ªå‹•å‡¦ç†: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«4ã‚µã‚¤ã‚ºÃ—3ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç”Ÿæˆ
  - AVIFå½¢å¼ãƒ¡ã‚¤ãƒ³: æ¬¡ä¸–ä»£ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆé«˜åœ§ç¸®ç‡ï¼‰
  - WebP/JPEG fallback: ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆç¢ºä¿
  - ç”»åƒå‰Šé™¤æ©Ÿèƒ½
  - ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
- ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¬ãƒãƒ£ä½œæˆå¾Œã«è¡¨ç¤ºï¼‰
  - ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«
  - ã‚¢ã‚¤ãƒ†ãƒ åã€åœ¨åº«æ•°ã€å…¬é–‹çŠ¶æ…‹ã€ç”»åƒ
  - ã‚¢ã‚¤ãƒ†ãƒ ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½
- ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³
- ä¸€è¦§ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆé·ç§»å…ˆ: `/my-gacha`ï¼‰

### 2.3 ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¢ã‚¤ãƒ†ãƒ åï¼ˆå¿…é ˆã€æœ€å¤§128æ–‡å­—ï¼‰
- èª¬æ˜ï¼ˆæœ€å¤§1000æ–‡å­—ï¼‰
- åœ¨åº«æ•°ï¼ˆ0ä»¥ä¸Šã®æ•´æ•°ï¼‰
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ï¼ˆJPEG, PNG, WebPå¯¾å¿œã€AVIFè‡ªå‹•å¤‰æ›ï¼‰
  - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
  - ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆæœ€é©ã‚µã‚¤ã‚ºè‡ªå‹•é¸æŠï¼‰
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚æœ€å¤§10MB
  - Sharp.jsè‡ªå‹•å‡¦ç†: 4ã‚µã‚¤ã‚ºç”Ÿæˆï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«ã€ã‚µãƒ ãƒã‚¤ãƒ«ã€ãƒ¢ãƒã‚¤ãƒ«ç”¨ã€é«˜è§£åƒåº¦ç”¨ï¼‰
  - æ—¢å­˜ç”»åƒã®ç½®ãæ›ãˆãƒ»å‰Šé™¤æ©Ÿèƒ½
- ç”»åƒURLï¼ˆMinIOã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼ã€è¤‡æ•°ã‚µã‚¤ã‚ºå¯¾å¿œã€è‡ªå‹•ç”Ÿæˆï¼‰
- å…¬é–‹/éå…¬é–‹åˆ‡æ›¿
- ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³

### 2.4 ç”»åƒç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ç”»åƒä¸€è¦§
- ç”»åƒã®ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º
- ç”»åƒã®å‰Šé™¤ãƒ»ç½®ãæ›ãˆæ©Ÿèƒ½
- ä½¿ç”¨ä¸­ã®ç”»åƒã®è¡¨ç¤ºï¼ˆã©ã®ã‚¢ã‚¤ãƒ†ãƒ ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ï¼‰
- æœªä½¿ç”¨ç”»åƒã®ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ï¼ˆå°†æ¥å¯¾å¿œï¼‰

### 2.5 å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¬ãƒãƒ£å‰Šé™¤æ™‚ã®ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- å‰Šé™¤/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³
- ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤æ™‚ã®ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ç”»åƒå‰Šé™¤æ™‚ã®ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆé–¢é€£ã‚¢ã‚¤ãƒ†ãƒ ã®è­¦å‘Šå«ã‚€ï¼‰

## 3. ç”»é¢é·ç§»ã‚¤ãƒ¡ãƒ¼ã‚¸ âœ… URLåˆ†é›¢å®Œäº†
- ãƒã‚¤ã‚¬ãƒãƒ£ç®¡ç†ä¸€è¦§ (`/my-gacha`) â†’ [æ–°è¦ä½œæˆ] â†’ ã‚¬ãƒãƒ£æ–°è¦ä½œæˆç”»é¢ (`/my-gacha/new`) â†’ æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º â†’ è‡ªå‹•çš„ã«ã‚¬ãƒãƒ£ç·¨é›†ç”»é¢ã«é·ç§» (`/my-gacha/edit/:id`)
- ãƒã‚¤ã‚¬ãƒãƒ£ç®¡ç†ä¸€è¦§ (`/my-gacha`) â†’ [ç·¨é›†] â†’ ã‚¬ãƒãƒ£ç·¨é›†ç”»é¢ (`/my-gacha/edit/:id`)ï¼ˆã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†å«ã‚€ï¼‰
- ãƒã‚¤ã‚¬ãƒãƒ£ç®¡ç†ä¸€è¦§ (`/my-gacha`) â†’ [å‰Šé™¤] â†’ å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¬ãƒãƒ£ç·¨é›†ç”»é¢ (`/my-gacha/edit/:id`) â†’ [ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ ] â†’ ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ â†’ [ç·¨é›†] â†’ ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ â†’ [å‰Šé™¤] â†’ å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- ã‚¬ãƒãƒ£ç·¨é›†ç”»é¢ â†’ [ä¸€è¦§ã«æˆ»ã‚‹] â†’ ãƒã‚¤ã‚¬ãƒãƒ£ç®¡ç†ä¸€è¦§ (`/my-gacha`)
- ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹/é€²ã‚€ãƒœã‚¿ãƒ³å¯¾å¿œ

## 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»UX
- å¿…é ˆé …ç›®æœªå…¥åŠ›æ™‚ã¯ä¿å­˜ä¸å¯
- ã‚¬ãƒãƒ£å: 1-128æ–‡å­—ã€å¿…é ˆ
- èª¬æ˜: 0-1000æ–‡å­—
- ä¾¡æ ¼: 1ä»¥ä¸Šã®æ•´æ•°ã€å¿…é ˆ
- ã‚¢ã‚¤ãƒ†ãƒ å: 1-128æ–‡å­—ã€å¿…é ˆ
- åœ¨åº«æ•°: 0ä»¥ä¸Šã®æ•´æ•°
- ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«: JPEG/PNG/WebPã€æœ€å¤§5MB
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®é€²æ—è¡¨ç¤º
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- æ–°è¦ã‚¬ãƒãƒ£ä½œæˆæˆåŠŸæ™‚ã¯æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- ã‚¢ã‚¤ãƒ†ãƒ ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å‹•çš„ã«è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- ç”»åƒå‰Šé™¤æ™‚ã®å®‰å…¨ç¢ºèªï¼ˆä½¿ç”¨ä¸­ã®ç”»åƒã®è­¦å‘Šï¼‰

## 5. APIè¨­è¨ˆ âœ… å®Ÿè£…å®Œäº†
### 5.1 ç®¡ç†ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ/api/admin/*ï¼‰
- âœ… GET /api/admin/gachas ... ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¬ãƒãƒ£ä¸€è¦§å–å¾—ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- âœ… POST /api/admin/gachas ... ã‚¬ãƒãƒ£æ–°è¦ä½œæˆ
- âœ… PUT /api/admin/gachas/:id ... ã‚¬ãƒãƒ£ç·¨é›†
- âœ… DELETE /api/admin/gachas/:id ... ã‚¬ãƒãƒ£å‰Šé™¤
- âœ… PATCH /api/admin/gachas/:id/publish ... å…¬é–‹çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆ
- âœ… GET /api/admin/gachas/:id/items ... ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§å–å¾—
- âœ… POST /api/admin/gachas/:id/items ... ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
- âœ… PUT /api/admin/gachas/:gachaId/items/:itemId ... ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†
- âœ… DELETE /api/admin/gachas/:gachaId/items/:itemId ... ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤

### 5.2 ã‚¬ãƒãƒ£ç”»åƒç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆæ–°è¦è¿½åŠ ï¼‰
- ğŸ”„ POST /api/admin/gachas/:id/images/upload ... ã‚¬ãƒãƒ£ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆMinIOã¸ã€Sharp.jså‡¦ç†ï¼‰
- ğŸ”„ GET /api/admin/gachas/:id/images ... ã‚¬ãƒãƒ£ã®ç”»åƒä¸€è¦§å–å¾—ï¼ˆå…¨ã‚µã‚¤ã‚ºæƒ…å ±å«ã‚€ï¼‰
- ğŸ”„ PUT /api/admin/gachas/:id/images/order ... ã‚¬ãƒãƒ£ç”»åƒã®ä¸¦ã³é †å¤‰æ›´
- ğŸ”„ DELETE /api/admin/gachas/:id/images/:imageId ... ã‚¬ãƒãƒ£ç”»åƒå‰Šé™¤ï¼ˆå…¨ã‚µã‚¤ã‚ºä¸€æ‹¬å‰Šé™¤ï¼‰
- ğŸ”„ PATCH /api/admin/gachas/:id/images/:imageId/main ... ãƒ¡ã‚¤ãƒ³ç”»åƒè¨­å®š

### 5.3 ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒç®¡ç†ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆæ—¢å­˜ï¼‰
- âœ… POST /api/admin/images/upload ... ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆMinIOã¸ã€Sharp.jså‡¦ç†ï¼‰
- âœ… GET /api/admin/images ... ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»åƒä¸€è¦§å–å¾—ï¼ˆå…¨ã‚µã‚¤ã‚ºæƒ…å ±å«ã‚€ï¼‰
- âœ… DELETE /api/admin/images/:objectKey ... ç”»åƒå‰Šé™¤ï¼ˆå…¨ã‚µã‚¤ã‚ºä¸€æ‹¬å‰Šé™¤ï¼‰
- âŒ GET /api/admin/images/:objectKey/usage ... ç”»åƒä½¿ç”¨çŠ¶æ³ç¢ºèª

### 5.4 MinIOçµ±åˆä»•æ§˜
- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†**: multipart/form-dataã§ãƒ•ã‚¡ã‚¤ãƒ«å—ä¿¡ â†’ Sharp.jså‡¦ç†
- **ç”»åƒå‡¦ç†ãƒ•ãƒ­ãƒ¼**:
  1. ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å—ä¿¡ï¼ˆJPEG/PNG/WebPã€æœ€å¤§10MBï¼‰
  2. Sharp.jsã«ã‚ˆã‚‹4ã‚µã‚¤ã‚ºç”Ÿæˆï¼š
     - original: æœ€å¤§2048x2048px
     - thumbnail: 150x150px
     - mobile: 512x512px
     - desktop: 1024x1024px
  3. å„ã‚µã‚¤ã‚ºã‚’AVIF/WebP/JPEGå½¢å¼ã§ä¿å­˜ï¼ˆè¨ˆ12ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼æ§‹é€ **:
  - ã‚¢ã‚¤ãƒ†ãƒ ç”»åƒ: `users/{user_id}/items/{size}/{format}/{timestamp}_{filename}`
  - ã‚¬ãƒãƒ£ç”»åƒ: `users/{user_id}/gachas/{gacha_id}/{size}/{format}/{timestamp}_{filename}`
- **ç”»åƒURLç”Ÿæˆ**: `http://localhost:9000/gacha-images/{object_key}`
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: ãƒ•ã‚¡ã‚¤ãƒ«åã€å…ƒã‚µã‚¤ã‚ºã€å„å¤‰æ›ã‚µã‚¤ã‚ºã€MIMEã‚¿ã‚¤ãƒ—ã‚’MinIOã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
- **é‡è¤‡å›é¿**: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— + ãƒ¦ãƒ¼ã‚¶ãƒ¼ID + ã‚¬ãƒãƒ£IDçµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ç”Ÿæˆ

### 5.5 èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- âœ… JWTèªè¨¼ã«ã‚ˆã‚‹æœ¬äººç¢ºèª
- âœ… ã‚¬ãƒãƒ£ã‚ªãƒ¼ãƒŠãƒ¼ã‚·ãƒƒãƒ—æ¤œè¨¼ï¼ˆæœ¬äººã®ã‚¬ãƒãƒ£ã®ã¿ç®¡ç†å¯èƒ½ï¼‰
- âœ… SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªï¼‰
- âœ… å…¥åŠ›å€¤æ¤œè¨¼ï¼ˆJoiï¼‰
- âœ… ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ï¼ˆMIMEã‚¿ã‚¤ãƒ—ã€ãƒã‚¸ãƒƒã‚¯ãƒã‚¤ãƒˆç¢ºèªï¼‰
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚æœ€å¤§10MBï¼‰
- âŒ ç”»åƒã‚¢ã‚¯ã‚»ã‚¹æ¨©é™åˆ¶å¾¡ï¼ˆMinIOå´è¨­å®šï¼‰
- âœ… Sharp.jsç”»åƒå‡¦ç†ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆä¸æ­£ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ã€ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼‰

### 5.6 ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
```json
// ã‚¬ãƒãƒ£ä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "gachas": [
    {
      "id": 1,
      "name": "ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚¬ãƒãƒ£",
      "description": "ãƒ¬ã‚¢ãªã‚¢ã‚¤ãƒ†ãƒ ãŒå½“ãŸã‚‹ã‚¬ãƒãƒ£ã§ã™",
      "price": 100,
      "is_public": true,
      "main_image_url": "http://localhost:9000/gacha-images/users/1/gachas/1/1704067200000_gacha_main.jpg",
      "created_at": "2024-01-01T00:00:00.000Z",
      "updated_at": "2024-01-01T00:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 50,
    "page": 1,
    "limit": 10,
    "totalPages": 5
  }
}

// ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "items": [
    {
      "id": 1,
      "name": "ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰",
      "description": "è²´é‡ãªãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰",
      "stock": 100,
      "image_url": "http://localhost:9000/gacha-images/users/123/items/1640995200000_diamond.png",
      "is_public": true
    }
  ]
}

//ã‚¬ãƒãƒ£ç”»åƒä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæ–°è¦è¿½åŠ ï¼‰
{
  "images": [
    {
      "id": 1,
      "gacha_id": 1,
      "original_filename": "main.jpg",
      "display_order": 1,
      "is_main": true,
      "created_at": "2024-01-01T00:00:00.000Z",
      "sizes": {
        "original": {
          "avif": "http://localhost:9000/gacha-images/users/123/gachas/1/original/avif/1640995200000_main.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/gachas/1/original/webp/1640995200000_main.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/gachas/1/original/jpeg/1640995200000_main.jpg",
          "width": 2048,
          "height": 1536
        },
        "desktop": {
          "avif": "http://localhost:9000/gacha-images/users/123/gachas/1/desktop/avif/1640995200000_main.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/gachas/1/desktop/webp/1640995200000_main.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/gachas/1/desktop/jpeg/1640995200000_main.jpg",
          "width": 1024,
          "height": 768
        },
        "mobile": {
          "avif": "http://localhost:9000/gacha-images/users/123/gachas/1/mobile/avif/1640995200000_main.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/gachas/1/mobile/webp/1640995200000_main.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/gachas/1/mobile/jpeg/1640995200000_main.jpg",
          "width": 512,
          "height": 384
        },
        "thumbnail": {
          "avif": "http://localhost:9000/gacha-images/users/123/gachas/1/thumbnail/avif/1640995200000_main.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/gachas/1/thumbnail/webp/1640995200000_main.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/gachas/1/thumbnail/jpeg/1640995200000_main.jpg",
          "width": 150,
          "height": 150
        }
      }
    }
  ]
}

// ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "image_id": 123,
  "original_filename": "diamond.png",
  "sizes": {
    "original": {
      "avif": "http://localhost:9000/gacha-images/users/123/items/original/avif/1640995200000_diamond.avif",
      "webp": "http://localhost:9000/gacha-images/users/123/items/original/webp/1640995200000_diamond.webp",
      "jpeg": "http://localhost:9000/gacha-images/users/123/items/original/jpeg/1640995200000_diamond.jpg"
    },
    "desktop": {
      "avif": "http://localhost:9000/gacha-images/users/123/items/desktop/avif/1640995200000_diamond.avif",
      "webp": "http://localhost:9000/gacha-images/users/123/items/desktop/webp/1640995200000_diamond.webp",
      "jpeg": "http://localhost:9000/gacha-images/users/123/items/desktop/jpeg/1640995200000_diamond.jpg"
    },
    "mobile": {
      "avif": "http://localhost:9000/gacha-images/users/123/items/mobile/avif/1640995200000_diamond.avif",
      "webp": "http://localhost:9000/gacha-images/users/123/items/mobile/webp/1640995200000_diamond.webp",
      "jpeg": "http://localhost:9000/gacha-images/users/123/items/mobile/jpeg/1640995200000_diamond.jpg"
    },
    "thumbnail": {
      "avif": "http://localhost:9000/gacha-images/users/123/items/thumbnail/avif/1640995200000_diamond.avif",
      "webp": "http://localhost:9000/gacha-images/users/123/items/thumbnail/webp/1640995200000_diamond.webp",
      "jpeg": "http://localhost:9000/gacha-images/users/123/items/thumbnail/jpeg/1640995200000_diamond.jpg"
    }
  },
  "metadata": {
    "original_size": 2048576,
    "original_format": "png",
    "processing_time": "1.2s"
  }
}

// ç”»åƒä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "images": [
    {
      "id": 1,
      "original_filename": "diamond.png",
      "uploaded_at": "2024-01-01T00:00:00.000Z",
      "used_by_items": ["ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰", "ãƒ¬ã‚¢ãƒ€ã‚¤ãƒ¤"],
      "sizes": {
        "original": {
          "avif": "http://localhost:9000/gacha-images/users/123/items/original/avif/1640995200000_diamond.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/items/original/webp/1640995200000_diamond.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/items/original/jpeg/1640995200000_diamond.jpg",
          "file_size": 156789
        },
        "desktop": {
          "avif": "http://localhost:9000/gacha-images/users/123/items/desktop/avif/1640995200000_diamond.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/items/desktop/webp/1640995200000_diamond.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/items/desktop/jpeg/1640995200000_diamond.jpg",
          "file_size": 98765
        },
        "mobile": {
          "avif": "http://localhost:9000/gacha-images/users/123/items/mobile/avif/1640995200000_diamond.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/items/mobile/webp/1640995200000_diamond.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/items/mobile/jpeg/1640995200000_diamond.jpg",
          "file_size": 45123
        },
        "thumbnail": {
          "avif": "http://localhost:9000/gacha-images/users/123/items/thumbnail/avif/1640995200000_diamond.avif",
          "webp": "http://localhost:9000/gacha-images/users/123/items/thumbnail/webp/1640995200000_diamond.webp",
          "jpeg": "http://localhost:9000/gacha-images/users/123/items/thumbnail/jpeg/1640995200000_diamond.jpg",
          "file_size": 12345
        }
      }
    }
  ]
}
```

## 6. æŠ€è¡“ä»•æ§˜ âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å®Œäº†
### 6.1 å®Ÿè£…æ¸ˆã¿æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Node.js + Fastify + JWTèªè¨¼
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: PostgreSQLï¼ˆå®Œå…¨ã‚¹ã‚­ãƒ¼ãƒå¯¾å¿œï¼‰
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: Joiï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰
- âœ… èªè¨¼: JWT + ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èªè¨¼
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã€ã‚ªãƒ¼ãƒŠãƒ¼ã‚·ãƒƒãƒ—æ¤œè¨¼

### 6.2 å®Ÿè£…æ¸ˆã¿æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Node.js + Fastify + JWTèªè¨¼
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: PostgreSQLï¼ˆå®Œå…¨ã‚¹ã‚­ãƒ¼ãƒå¯¾å¿œï¼‰
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: Joiï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰
- âœ… èªè¨¼: JWT + ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èªè¨¼
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã€ã‚ªãƒ¼ãƒŠãƒ¼ã‚·ãƒƒãƒ—æ¤œè¨¼
- âœ… MinIOçµ±åˆ: MinIO Clientï¼ˆminio JavaScript libraryï¼‰
- âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰: Fastify Multipart Plugin
- âŒ ç”»åƒå‡¦ç†: Sharpï¼ˆãƒªã‚µã‚¤ã‚ºãƒ»æœ€é©åŒ–ãƒ»AVIFå¤‰æ›ï¼‰

### 6.3 MinIOæŠ€è¡“ä»•æ§˜
- **ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: `minio` JavaScript client + `sharp` ç”»åƒå‡¦ç†
- **ãƒã‚±ãƒƒãƒˆ**: `gacha-images`
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: ãƒ‘ãƒ–ãƒªãƒƒã‚¯èª­ã¿å–ã‚Šè¨±å¯
- **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼å½¢å¼**: `users/{user_id}/{type}/{size}/{format}/{timestamp}_{filename}`
- **ã‚µã‚¤ã‚ºç¨®åˆ¥**: original, desktop, mobile, thumbnail
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¨®åˆ¥**: avif, webp, jpegï¼ˆå„ªå…ˆé †ï¼‰
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**: `x-amz-meta-original-name`, `x-amz-meta-uploaded-by`, `x-amz-meta-original-size`
- **URLå½¢å¼**: `http://localhost:9000/gacha-images/{object_key}`

### 6.4 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®Ÿè£…çŠ¶æ³
- âœ… gachas ãƒ†ãƒ¼ãƒ–ãƒ«: å®Œå…¨å¯¾å¿œï¼ˆis_publicåˆ—ä½¿ç”¨ï¼‰
- âœ… gacha_items ãƒ†ãƒ¼ãƒ–ãƒ«: å®Œå…¨CRUDå¯¾å¿œã€image_urlåˆ—ã§MinIOã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆURLä¿å­˜ï¼ˆè¤‡æ•°ã‚µã‚¤ã‚ºå¯¾å¿œï¼‰
- âœ… users ãƒ†ãƒ¼ãƒ–ãƒ«: èªè¨¼å¯¾å¿œ
- âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: æœ€æ–°ã‚¹ã‚­ãƒ¼ãƒé©ç”¨æ¸ˆã¿
- âŒ images ãƒ†ãƒ¼ãƒ–ãƒ«: MinIOç”»åƒãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆè¤‡æ•°ã‚µã‚¤ã‚ºãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œï¼‰
- âŒ image_variants ãƒ†ãƒ¼ãƒ–ãƒ«: ç”»åƒã‚µã‚¤ã‚ºåˆ¥URLç®¡ç†ï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

## 7. å®Ÿè£…å®Œäº†äº‹é …ãƒ»å‚™è€ƒ
### 7.1 å®Œäº†æ¸ˆã¿æ©Ÿèƒ½
- âœ… ç®¡ç†ç”¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¨æ©Ÿèƒ½
- âœ… JWTèªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- âœ… ã‚¬ãƒãƒ£CRUDæ“ä½œï¼ˆä½œæˆãƒ»èª­å–ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰
- âœ… ã‚¢ã‚¤ãƒ†ãƒ CRUDæ“ä½œï¼ˆä½œæˆãƒ»èª­å–ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰
- âœ… å…¬é–‹çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
- âœ… ã‚ªãƒ¼ãƒŠãƒ¼ã‚·ãƒƒãƒ—æ¤œè¨¼ï¼ˆæœ¬äººã®ã‚¬ãƒãƒ£ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯ï¼‰
- âœ… å…¥åŠ›å€¤æ¤œè¨¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ

### 7.2 å®Ÿè£…å¾…ã¡æ©Ÿèƒ½
- ğŸ”„ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œï¼ˆã‚¹ãƒãƒ›ãƒ»PCï¼‰
- ğŸ”„ Material-UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãŸãƒ¢ãƒ€ãƒ³ãªUI
- ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®çŠ¶æ…‹æ›´æ–°ï¼ˆå…¬é–‹/éå…¬é–‹åˆ‡ã‚Šæ›¿ãˆç­‰ï¼‰
- ğŸ”„ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å…¨ç”»é¢å®Ÿè£…
- âŒ ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œï¼‰
- âŒ ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ç®¡ç†æ©Ÿèƒ½ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç”»åƒè¡¨ç¤ºï¼‰
- âŒ Sharp.jsçµ±åˆã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
- âŒ ç”»åƒã®è‡ªå‹•ãƒªã‚µã‚¤ã‚ºãƒ»AVIFå¤‰æ›
- âŒ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€²æ—è¡¨ç¤º
- âŒ ç”»åƒä½¿ç”¨çŠ¶æ³è¡¨ç¤ºæ©Ÿèƒ½
- âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆåˆ¤å®šæ©Ÿèƒ½ï¼ˆAVIF/WebP/JPEGè‡ªå‹•åˆ‡ã‚Šæ›¿ãˆï¼‰

### 7.3 é–‹ç™ºãƒ¡ãƒ¢
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¯çµ±ä¸€æ¸ˆã¿ï¼ˆis_publicåˆ—ä½¿ç”¨ï¼‰
- èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹è‡ªå‹•çš„ãªæœ¬äººç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ¨™æº–åŒ–å®Œäº†
- API ãƒ†ã‚¹ãƒˆå®Œäº†ï¼ˆcurl ã«ã‚ˆã‚‹å‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰
- Sharp.jsçµ±åˆã«ã‚ˆã‚Šç”»åƒURLã¯å‹•çš„ç”Ÿæˆï¼ˆãƒ‡ãƒã‚¤ã‚¹ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã«å¿œã˜ãŸæœ€é©ç”»åƒé¸æŠï¼‰
- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ãŒå¿…è¦ï¼ˆMIMEã‚¿ã‚¤ãƒ—ã€ãƒã‚¸ãƒƒã‚¯ãƒã‚¤ãƒˆã€Sharp.jså‡¦ç†æ™‚ãƒ¡ãƒ¢ãƒªåˆ¶é™ï¼‰
- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯æ€§ç¢ºä¿ãŒé‡è¦ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— + ãƒ¦ãƒ¼ã‚¶ãƒ¼ID + ã‚µã‚¤ã‚º + ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä½¿ç”¨ï¼‰
- æœ¬ç•ªç’°å¢ƒã§ã¯ç”»åƒCDNé€£æºã‚’æ¤œè¨ï¼ˆCloudFrontç­‰ï¼‰
- AVIFæœªå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®fallbackæˆ¦ç•¥å®Ÿè£…ãŒå¿…è¦
