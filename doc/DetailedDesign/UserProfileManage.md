# ユーザープロフィール管理画面 詳細設計（実装同期版）

## 1. 画面概要
- ログインユーザーが自分のプロフィール（アイコン・名前・メール・パスワード）を管理できる画面
- 画像アップロード・Sharp.js変換・バリデーション・リアルタイムUI反映
- **URL**: `/profile`
- **遷移先**: なし（マイページ単体）

## 2. 主な機能
- プロフィール情報表示（アイコン・ID・登録日・更新日）
- プロフィール編集（アイコン/名前/メール/パスワード）
- アイコン画像アップロード・削除（JPEG/PNG/GIF, 5MB, AVIF変換, 4サイズ）
- 入力バリデーション（Yup/Joi）
- 保存ボタンで変更項目のみ送信
- 成功/失敗時のスナックバー通知
- 危険な操作（アカウント削除: 将来実装）
- レスポンシブデザイン

## 3. UI/UX特徴
- Material-UI + Framer Motionによるモダンデザイン
- アイコン画像プレビュー・削除
- 入力欄は「変更時のみ入力」方式
- 保存ボタンは一つのみ
- 成功/エラー時のスナックバー通知
- アクセシビリティ配慮

## 4. 表示データ項目
- **ユーザーアイコン**: avatarImageUrl（AVIF, 32px/64px/128px/256px）
- **ユーザーID**: id
- **ユーザー名**: name
- **メールアドレス**: email
- **登録日時**: createdAt
- **最終更新日時**: updatedAt

## 5. API設計
- **GET /api/auth/me** ... プロフィール情報取得
- **POST /api/auth/avatar** ... アイコン画像アップロード
- **DELETE /api/auth/avatar** ... アイコン画像削除
- **PUT /api/auth/profile** ... プロフィール統合更新（name/email/password/avatarImageId）
  - 変更項目のみ送信、バリデーションエラーは`error`/`details`で返却

## 6. バリデーション・UX
- Yup（フロント）/Joi（バックエンド）でバリデーション
- 画像: JPEG/PNG/GIF, 5MB以下, AVIF自動変換
- ユーザー名: 2-64文字、重複不可
- メール: 形式・重複チェック
- パスワード: 8文字以上・英数字必須
- 何も変更がなければ送信不可
- エラーは即時表示

## 7. 権限制御
- ログインユーザーのみアクセス可
- 自分のプロフィールのみ編集可
- JWT認証必須

## 8. 技術仕様
- フロント: React 18 + Material-UI v5
- 状態管理: React Hooks
- API通信: Fetch API with utils/api.js
- バリデーション: Yup（フロント）/Joi（バックエンド）
- 画像処理: Sharp.js（AVIF/4サイズ）
- ストレージ: MinIO S3互換
- DB: PostgreSQL（user_avatar_images, user_avatar_variants, users拡張）

## 9. エラーハンドリング
- API/ネットワークエラー時はスナックバー通知
- バリデーションエラーは各項目に即時表示
- 画像処理失敗時はエラーメッセージ

## 10. パフォーマンス考慮
- 画像遅延読み込み
- AVIF/WebP配信
- キャッシュ戦略
- 画像アップロード・Sharp.js処理は非同期

## 11. 今後の拡張予定
- アカウント削除機能
- メール認証機能
- 二段階認証
- 画像クロップ・テンプレート
- 画像管理ダッシュボード
- プロフィール公開範囲設定
