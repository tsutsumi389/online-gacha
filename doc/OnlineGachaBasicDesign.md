---

# オンラインガチャシステム 基本設計書（ドラフト）

## 1. システム概要

本システムは、ユーザーがオンライン上でガチャを引き、商品を獲得できるWebサービスです。店舗管理者はガチャの作成・管理・確率調整を行います。システムはDocker環境上で動作し、データベースにはPostgreSQLを使用します。

## 2. ユーザー種別と権限

| ユーザー種別     | 主な権限・機能                                 |
|------------------|-----------------------------------------------|
| 一般ユーザー     | ガチャ一覧閲覧、ガチャ詳細閲覧、ガチャ実行     |
| 店舗管理者       | ガチャ一覧管理、ガチャ登録・編集・削除、確率調整|

## 3. 画面仕様

### 3.1 ユーザー側

- **ガチャ一覧画面**
	- 利用可能なガチャのリスト表示
	- 各ガチャの簡易情報（名称、価格、提供割合など）

- **ガチャ詳細画面**
	- ガチャの詳細情報（商品リスト、各商品の当選確率、説明）

- **ガチャ演出画面**
	- ガチャ演出（リッチなアニメーション、パーティクル、2D/3D表現など）
	  - Framer MotionによるUIアニメーション
	  - Three.js/PixiJSによる演出（例：カプセルが回転・破裂、光のエフェクト等）
	- 結果表示（当選商品）

### 3.2 店舗管理者側

- **ガチャ一覧画面**
	- 登録済みガチャのリスト表示
	- 編集・削除・新規作成ボタン

- **ガチャ管理画面**
	- ガチャ名、説明、価格、ガチャ一覧に表示する画像（複数）、ガチャの表示期間の登録・編集
	- 商品内容（商品名、画像、説明、在庫数）

## 4. システム構成

- **Webアプリケーション**
	- フロントエンド：React + Framer Motion / Three.js / PixiJS
	  - Framer Motion：UIアニメーション
	  - Three.js / PixiJS：ガチャ演出（2D/3Dアニメーション、パーティクル等）
	- バックエンド：Node.js（Fastify）
- **DB**：PostgreSQL
- **インフラ**：Docker（docker-composeでWeb/DBを構築）

## 5. データベース設計（概略）

- users（ユーザー情報）
- gachas（ガチャ情報）
- gacha_items（ガチャ内の商品情報）
- gacha_results（ガチャ実行履歴）
- admins（店舗管理者情報）

## 6. 機能一覧

| 機能名             | 概要                                         | 対象ユーザー   |
|--------------------|----------------------------------------------|---------------|
| ガチャ一覧表示     | ガチャのリストを表示                         | 全ユーザー    |
| ガチャ詳細表示     | ガチャの詳細情報を表示                       | 全ユーザー    |
| ガチャ実行         | ガチャを引き、結果を表示                     | 全ユーザー    |
| ガチャ登録・編集   | ガチャの新規作成・編集・削除                  | 店舗管理者    |
| 商品・確率設定     | ガチャ内商品の登録・確率調整                  | 店舗管理者    |

## 7. Docker構成（例）

- web: Webアプリケーション
- db: PostgreSQL

```yaml
version: '3'
services:
	web:
		build: .
		ports:
			- "8080:8080"
		depends_on:
			- db
	db:
		image: postgres:16
		environment:
			POSTGRES_USER: user
			POSTGRES_PASSWORD: password
			POSTGRES_DB: gacha_db
		ports:
			- "5432:5432"
		volumes:
			- db_data:/var/lib/postgresql/data
volumes:
	db_data:
```

## 8. 今後の検討事項

- 認証・認可方式
- 決済機能の有無
- 商品発送管理の有無

---
