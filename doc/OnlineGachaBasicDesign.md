---

# オンラインガチャシステム 基本設計書（ドラフト）

## 1. システム概要

本システムは、ユーザーがオンライン上でガチャを引き、商品を獲得できるWebサービスです。すべてのユーザーはガチャを作成・管理することも、他のユーザーが作成したガチャを引くこともできます。システムはDocker環境上で動作し、データベースにはPostgreSQLを使用します。

## 2. ユーザー権限

| ユーザーロール   | 主な権限・機能                                                               |
|------------------|-----------------------------------------------------------------------------|
| 一般ユーザー     | ガチャ一覧閲覧、ガチャ詳細閲覧、ガチャ実行、自分のガチャ作成・編集・削除      |
| 管理者           | 全ガチャの管理、全ユーザーの管理、システム全体の監視                        |

**注意**: すべてのユーザーはガチャの作成と実行の両方が可能です。管理者は追加でシステム全体の管理権限を持ちます。

## 3. 画面仕様

### 3.1 ガチャを引く側の機能

- **ガチャ一覧画面**
	- 利用可能なガチャのリスト表示
	- 各ガチャの簡易情報（名称、価格、提供割合など）
	- 自分が作成したガチャと他のユーザーが作成したガチャを区別表示

- **ガチャ詳細画面**
	- ガチャの詳細情報（商品リスト、各商品の当選確率、説明）

- **ガチャ演出画面**
	- ガチャ演出（リッチなアニメーション、パーティクル、2D/3D表現など）
	  - Framer MotionによるUIアニメーション
	  - Three.js/PixiJSによる演出（例：カプセルが回転・破裂、光のエフェクト等）
	- 結果表示（当選商品）

### 3.2 ガチャを作る側の機能

- **マイガチャ一覧画面**
	- 自分が作成したガチャのリスト表示
	- 編集・削除・新規作成ボタン
	- ガチャの実行統計表示

- **ガチャ作成・編集画面**
	- ガチャ名、説明、価格、ガチャ一覧に表示する画像（複数）、ガチャの表示期間の登録・編集
	- 商品内容（商品名、画像、説明、在庫数）の管理

### 3.3 認証関連画面

- **ログイン画面**
	- メールアドレス・パスワード入力フォーム
	- ログインボタン
	- 新規登録画面へのリンク
	- パスワードリセット機能（将来対応）
	- ソーシャルログイン対応（Google、GitHub等）（将来対応）

- **新規登録画面**
	- ユーザー名、メールアドレス、パスワード入力フォーム
	- パスワード確認入力
	- 利用規約同意チェックボックス
	- 登録ボタン
	- ログイン画面へのリンク

- **プロフィール画面**
	- ユーザー情報表示・編集
	- ガチャ実行履歴表示
	- 作成したガチャ一覧
	- ログアウト機能

## 4. システム構成

- **Webアプリケーション**
	- フロントエンド：React + Material-UI + React Hook Form
	  - React Router: ページルーティング
	  - React Hook Form + Yup: フォーム管理・バリデーション
	  - Material-UI: UIコンポーネント
	  - Framer Motion: UIアニメーション
	  - Three.js / PixiJS: ガチャ演出（2D/3Dアニメーション、パーティクル等）
	- バックエンド：Node.js（Fastify）+ JWT認証
	  - Fastify: 高速Webフレームワーク
	  - JWT: ステートレス認証
	  - bcrypt: パスワードハッシュ化
	  - PostgreSQL: データベースアクセス
- **DB**：PostgreSQL
- **インフラ**：Docker（docker-composeでWeb/DBを構築）

### 4.1 認証システム
- **認証方式**: JWT（JSON Web Token）
- **セッション管理**: HttpOnly Cookie
- **パスワード**: bcryptでハッシュ化
- **セキュリティ**: CORS設定、レート制限対応

## 5. データベース設計（概略）

- users（ユーザー情報）
- gachas（ガチャ情報）
- gacha_items（ガチャ内の商品情報）
- gacha_results（ガチャ実行履歴）
- admins（店舗管理者情報）

## 6. 機能一覧

| 機能名             | 概要                                         | 対象ユーザー   | 認証要否 |
|--------------------|----------------------------------------------|---------------|----------|
| ユーザー登録       | 新規アカウント作成                           | 未登録ユーザー | 不要     |
| ログイン           | メールアドレス・パスワードでログイン         | 登録済みユーザー | 不要     |
| ログアウト         | セッション終了                               | ログイン済み   | 必要     |
| ガチャ一覧表示     | ガチャのリストを表示                         | 全ユーザー    | 不要     |
| ガチャ詳細表示     | ガチャの詳細情報を表示                       | 全ユーザー    | 不要     |
| ガチャ実行         | ガチャを引き、結果を表示                     | ログイン済み   | 必要     |
| マイガチャ管理     | 自分が作成したガチャの管理                   | ログイン済み   | 必要     |
| ガチャ作成・編集   | ガチャの新規作成・編集・削除                  | ログイン済み   | 必要     |
| 商品・確率設定     | ガチャ内商品の登録・確率調整                  | ログイン済み   | 必要     |
| プロフィール管理   | ユーザー情報編集・実行履歴確認               | ログイン済み   | 必要     |

## 7. Docker構成（例）

- web: Webアプリケーション
- db: PostgreSQL

```yaml
version: '3'
services:
	web:
		build: .
		ports:
			- "8080:8080"
		depends_on:
			- db
	db:
		image: postgres:16
		environment:
			POSTGRES_USER: user
			POSTGRES_PASSWORD: password
			POSTGRES_DB: gacha_db
		ports:
			- "5432:5432"
		volumes:
			- db_data:/var/lib/postgresql/data
volumes:
	db_data:
```

## 8. 今後の検討事項

- 認証・認可方式
- 決済機能の有無
- 商品発送管理の有無

---
